# Invitation System Architecture

## ğŸ—ï¸ System Architecture

### Overview Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           CHESS EMPIRE                                   â”‚
â”‚                      Invitation System v1.0                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           CLIENT SIDE                                    â”‚
â”‚                         (Browser / Frontend)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   admin.html     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   register.html  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  login.html   â”‚
â”‚                  â”‚         â”‚                  â”‚         â”‚               â”‚
â”‚ â€¢ App Access UI  â”‚         â”‚ â€¢ Token validate â”‚         â”‚ â€¢ Auth login  â”‚
â”‚ â€¢ Send Invite    â”‚         â”‚ â€¢ Password form  â”‚         â”‚ â€¢ Session mgmtâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                            â”‚
         â”‚ crud-management.js         â”‚ register.js
         â”‚ i18n.js                    â”‚ i18n.js
         â”‚                            â”‚
         â–¼                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       SUPABASE CLIENT                                    â”‚
â”‚                    (Anon Key - Public/Safe)                              â”‚
â”‚                                                                          â”‚
â”‚  const supabaseClient = createClient(                                   â”‚
â”‚    SUPABASE_URL,                                                        â”‚
â”‚    SUPABASE_ANON_KEY  â† Safe to expose in browser                       â”‚
â”‚  )                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                                              â”‚
            â”‚ 1. functions.invoke()                        â”‚ 2. auth.signUp()
            â”‚    'send-invitation'                         â”‚    auth.signIn()
            â”‚    { email }                                 â”‚
            â–¼                                              â–¼

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          SUPABASE SERVER                                 â”‚
â”‚                       (Secure Server-Side)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      EDGE FUNCTION              â”‚      â”‚    AUTHENTICATION              â”‚
â”‚   send-invitation/index.ts      â”‚      â”‚      (Auth Service)            â”‚
â”‚                                 â”‚      â”‚                                â”‚
â”‚ â€¢ Server-side execution         â”‚      â”‚ â€¢ User signup                  â”‚
â”‚ â€¢ Service role key access       â”‚      â”‚ â€¢ Email confirmation           â”‚
â”‚ â€¢ Creates invitation            â”‚      â”‚ â€¢ Session management           â”‚
â”‚ â€¢ Sends email via admin API     â”‚      â”‚ â€¢ Password hashing             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                           â”‚
         â”‚ Service Role Key                          â”‚ Auth operations
         â”‚ (Secure)                                  â”‚
         â–¼                                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SUPABASE ADMIN CLIENT                               â”‚
â”‚                   (Service Role - Server Only)                           â”‚
â”‚                                                                          â”‚
â”‚  const supabaseAdmin = createClient(                                    â”‚
â”‚    SUPABASE_URL,                                                        â”‚
â”‚    SUPABASE_SERVICE_ROLE_KEY  â† NEVER exposed to browser                â”‚
â”‚  )                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ Database operations
            â”‚ Admin API calls
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         POSTGRESQL DATABASE                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ coach_invitations    â”‚  â”‚    auth.users        â”‚  â”‚   user_roles      â”‚
â”‚                      â”‚  â”‚                      â”‚  â”‚                   â”‚
â”‚ â€¢ id (UUID)          â”‚  â”‚ â€¢ id (UUID)          â”‚  â”‚ â€¢ user_id         â”‚
â”‚ â€¢ email              â”‚  â”‚ â€¢ email              â”‚  â”‚ â€¢ role            â”‚
â”‚ â€¢ token (64 chars)   â”‚  â”‚ â€¢ encrypted_password â”‚  â”‚ â€¢ permissions     â”‚
â”‚ â€¢ coach_id           â”‚  â”‚ â€¢ created_at         â”‚  â”‚ â€¢ coach_id        â”‚
â”‚ â€¢ expires_at         â”‚  â”‚ â€¢ confirmed_at       â”‚  â”‚ â€¢ created_at      â”‚
â”‚ â€¢ used (boolean)     â”‚  â”‚ â€¢ email_confirmed_at â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ â€¢ created_at         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

         â”‚                          â”‚                          â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚  RPC Functions       â”‚
                         â”‚                      â”‚
                         â”‚ create_user_invitation()
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         EMAIL SERVICE                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SUPABASE BUILT-IN EMAIL                             â”‚
â”‚                                                                         â”‚
â”‚ â€¢ SMTP Configuration (Dashboard)                                       â”‚
â”‚ â€¢ Email Templates (Invite user)                                        â”‚
â”‚ â€¢ Automatic sending via auth.admin.inviteUserByEmail()                 â”‚
â”‚ â€¢ No third-party provider needed                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ Sends email
            â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  User Inbox â”‚
     â”‚             â”‚
     â”‚ ğŸ“§ Invitation
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Security Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SECURITY ARCHITECTURE                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LAYER 1: CLIENT-SIDE (Browser)                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âœ… Uses Anon Key (public, safe to expose)                              â”‚
â”‚  âœ… Cannot access admin API                                             â”‚
â”‚  âœ… Cannot bypass RLS policies                                          â”‚
â”‚  âœ… Can only call allowed Edge Functions                                â”‚
â”‚  âœ… CORS protected                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LAYER 2: EDGE FUNCTION (Server-Side)                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âœ… Runs on Supabase infrastructure                                     â”‚
â”‚  âœ… Service Role Key in environment (secure)                            â”‚
â”‚  âœ… Input validation                                                     â”‚
â”‚  âœ… Error handling                                                       â”‚
â”‚  âœ… Audit logging                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LAYER 3: DATABASE                                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âœ… Row Level Security (RLS) policies                                   â”‚
â”‚  âœ… Stored procedures with SECURITY DEFINER                             â”‚
â”‚  âœ… Cryptographic token generation                                      â”‚
â”‚  âœ… Timestamp validation (expires_at)                                   â”‚
â”‚  âœ… One-time use enforcement (used flag)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LAYER 4: AUTHENTICATION                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âœ… Password hashing (bcrypt)                                           â”‚
â”‚  âœ… JWT token signing                                                   â”‚
â”‚  âœ… Session management                                                  â”‚
â”‚  âœ… Rate limiting                                                        â”‚
â”‚  âœ… Email verification (optional)                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Data Flow

### Invitation Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      INVITATION CREATION FLOW                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Admin                Browser              Edge Function         Database         Email
  â”‚                     â”‚                      â”‚                   â”‚              â”‚
  â”‚ 1. Click "Send     â”‚                      â”‚                   â”‚              â”‚
  â”‚    Invite"         â”‚                      â”‚                   â”‚              â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                      â”‚                   â”‚              â”‚
  â”‚                    â”‚                      â”‚                   â”‚              â”‚
  â”‚                    â”‚ 2. POST to           â”‚                   â”‚              â”‚
  â”‚                    â”‚    /send-invitation  â”‚                   â”‚              â”‚
  â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                   â”‚              â”‚
  â”‚                    â”‚    {email}           â”‚                   â”‚              â”‚
  â”‚                    â”‚                      â”‚                   â”‚              â”‚
  â”‚                    â”‚                      â”‚ 3. Call           â”‚              â”‚
  â”‚                    â”‚                      â”‚    create_user_   â”‚              â”‚
  â”‚                    â”‚                      â”‚    invitation()   â”‚              â”‚
  â”‚                    â”‚                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚              â”‚
  â”‚                    â”‚                      â”‚                   â”‚              â”‚
  â”‚                    â”‚                      â”‚                   â”‚ 4. Generate  â”‚
  â”‚                    â”‚                      â”‚                   â”‚    token     â”‚
  â”‚                    â”‚                      â”‚                   â”‚    (64 chars)â”‚
  â”‚                    â”‚                      â”‚                   â”‚              â”‚
  â”‚                    â”‚                      â”‚                   â”‚ 5. Insert    â”‚
  â”‚                    â”‚                      â”‚                   â”‚    invitationâ”‚
  â”‚                    â”‚                      â”‚                   â”‚    record    â”‚
  â”‚                    â”‚                      â”‚                   â”‚              â”‚
  â”‚                    â”‚                      â”‚ 6. Return         â”‚              â”‚
  â”‚                    â”‚                      â”‚    {token, email} â”‚              â”‚
  â”‚                    â”‚                      â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
  â”‚                    â”‚                      â”‚                   â”‚              â”‚
  â”‚                    â”‚                      â”‚ 7. Call admin API â”‚              â”‚
  â”‚                    â”‚                      â”‚    inviteUserBy   â”‚              â”‚
  â”‚                    â”‚                      â”‚    Email()        â”‚              â”‚
  â”‚                    â”‚                      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
  â”‚                    â”‚                      â”‚                   â”‚              â”‚
  â”‚                    â”‚                      â”‚                   â”‚         8. Send
  â”‚                    â”‚                      â”‚                   â”‚            invitation
  â”‚                    â”‚                      â”‚                   â”‚            email
  â”‚                    â”‚                      â”‚                   â”‚              â”‚
  â”‚                    â”‚ 9. Return success    â”‚                   â”‚              â”‚
  â”‚                    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚              â”‚
  â”‚                    â”‚                      â”‚                   â”‚              â”‚
  â”‚ 10. Show success   â”‚                      â”‚                   â”‚              â”‚
  â”‚     message        â”‚                      â”‚                   â”‚              â”‚
  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚                   â”‚              â”‚
  â”‚                    â”‚                      â”‚                   â”‚              â”‚
```

### Registration Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       REGISTRATION FLOW                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User              Browser             Database            Auth Service
  â”‚                  â”‚                    â”‚                     â”‚
  â”‚ 1. Click email   â”‚                    â”‚                     â”‚
  â”‚    link          â”‚                    â”‚                     â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                    â”‚                     â”‚
  â”‚                  â”‚                    â”‚                     â”‚
  â”‚                  â”‚ 2. Load            â”‚                     â”‚
  â”‚                  â”‚    register.html   â”‚                     â”‚
  â”‚                  â”‚    ?token=xxx      â”‚                     â”‚
  â”‚                  â”‚                    â”‚                     â”‚
  â”‚                  â”‚ 3. Validate token  â”‚                     â”‚
  â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                     â”‚
  â”‚                  â”‚    SELECT * FROM   â”‚                     â”‚
  â”‚                  â”‚    coach_invitations                     â”‚
  â”‚                  â”‚    WHERE token=xxx â”‚                     â”‚
  â”‚                  â”‚                    â”‚                     â”‚
  â”‚                  â”‚ 4. Token valid     â”‚                     â”‚
  â”‚                  â”‚    (not used,      â”‚                     â”‚
  â”‚                  â”‚     not expired)   â”‚                     â”‚
  â”‚                  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
  â”‚                  â”‚                    â”‚                     â”‚
  â”‚ 5. Show password â”‚                    â”‚                     â”‚
  â”‚    form          â”‚                    â”‚                     â”‚
  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚                     â”‚
  â”‚                  â”‚                    â”‚                     â”‚
  â”‚ 6. Enter passwordâ”‚                    â”‚                     â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                    â”‚                     â”‚
  â”‚                  â”‚                    â”‚                     â”‚
  â”‚                  â”‚ 7. Create account  â”‚                     â”‚
  â”‚                  â”‚    auth.signUp()   â”‚                     â”‚
  â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
  â”‚                  â”‚                    â”‚                     â”‚
  â”‚                  â”‚                    â”‚                8. Hash
  â”‚                  â”‚                    â”‚                   password
  â”‚                  â”‚                    â”‚                     â”‚
  â”‚                  â”‚                    â”‚                9. Create
  â”‚                  â”‚                    â”‚                   user
  â”‚                  â”‚                    â”‚                     â”‚
  â”‚                  â”‚ 10. User created   â”‚                     â”‚
  â”‚                  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                  â”‚                    â”‚                     â”‚
  â”‚                  â”‚ 11. Mark token usedâ”‚                     â”‚
  â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                     â”‚
  â”‚                  â”‚    UPDATE invitations                    â”‚
  â”‚                  â”‚    SET used=TRUE   â”‚                     â”‚
  â”‚                  â”‚                    â”‚                     â”‚
  â”‚                  â”‚ 12. Create role    â”‚                     â”‚
  â”‚                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                     â”‚
  â”‚                  â”‚    INSERT INTO     â”‚                     â”‚
  â”‚                  â”‚    user_roles      â”‚                     â”‚
  â”‚                  â”‚                    â”‚                     â”‚
  â”‚ 13. Redirect to  â”‚                    â”‚                     â”‚
  â”‚     login page   â”‚                    â”‚                     â”‚
  â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚                     â”‚
  â”‚                  â”‚                    â”‚                     â”‚
```

---

## ğŸ—„ï¸ Database Schema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DATABASE RELATIONSHIPS                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   auth.users         â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ â€¢ id (PK)            â”‚â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ email              â”‚       â”‚
â”‚ â€¢ encrypted_password â”‚       â”‚ 1:1
â”‚ â€¢ created_at         â”‚       â”‚
â”‚ â€¢ confirmed_at       â”‚       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
                               â”‚
                               â”‚
                               â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   user_roles         â”‚
                    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
                    â”‚ â€¢ id (PK)            â”‚
                    â”‚ â€¢ user_id (FK) â—€â”€â”€â”€â”€â”€â”˜
                    â”‚ â€¢ role               â”‚
                    â”‚ â€¢ coach_id (FK)      â”‚â”€â”€â”€â”€â”
                    â”‚ â€¢ permissions        â”‚    â”‚
                    â”‚ â€¢ created_at         â”‚    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                                                â”‚
                                                â”‚ N:1
                                                â”‚
                                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ coach_invitations    â”‚                â”‚     coaches          â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚                â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ â€¢ id (PK)            â”‚                â”‚ â€¢ id (PK)            â”‚
â”‚ â€¢ email              â”‚                â”‚ â€¢ name               â”‚
â”‚ â€¢ token (UNIQUE)     â”‚                â”‚ â€¢ created_at         â”‚
â”‚ â€¢ coach_id (FK)      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚
â”‚ â€¢ expires_at         â”‚      N:1       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ â€¢ used               â”‚
â”‚ â€¢ created_at         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸŒ Component Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       FRONTEND COMPONENTS                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

admin.html
â”œâ”€â”€ App Access Section
â”‚   â”œâ”€â”€ Invitation Form
â”‚   â”‚   â”œâ”€â”€ Email Input
â”‚   â”‚   â””â”€â”€ Send Button â”€â”€â”€â–¶ sendInvitation()
â”‚   â”œâ”€â”€ User Management Table
â”‚   â””â”€â”€ Messages Display
â”‚
â”œâ”€â”€ Scripts
â”‚   â”œâ”€â”€ supabase-client.js (Anon client)
â”‚   â”œâ”€â”€ crud-management.js (Admin logic)
â”‚   â””â”€â”€ i18n.js (Translations)
â”‚
â””â”€â”€ Event Handlers
    â”œâ”€â”€ sendInvitation() â”€â”€â”€â–¶ Edge Function
    â””â”€â”€ loadUsers() â”€â”€â”€â–¶ Database query


register.html
â”œâ”€â”€ Registration Form
â”‚   â”œâ”€â”€ Email Input (readonly, pre-filled)
â”‚   â”œâ”€â”€ Password Input
â”‚   â”‚   â”œâ”€â”€ Strength Indicator
â”‚   â”‚   â””â”€â”€ Requirements Checklist
â”‚   â”œâ”€â”€ Confirm Password Input
â”‚   â””â”€â”€ Submit Button â”€â”€â”€â–¶ handleRegistration()
â”‚
â”œâ”€â”€ Scripts
â”‚   â”œâ”€â”€ supabase-client.js (Anon client)
â”‚   â”œâ”€â”€ register.js (Registration logic)
â”‚   â””â”€â”€ i18n.js (Translations)
â”‚
â””â”€â”€ Event Handlers
    â”œâ”€â”€ validateInvitation() â”€â”€â”€â–¶ Check token
    â”œâ”€â”€ validatePassword() â”€â”€â”€â–¶ Real-time check
    â””â”€â”€ handleRegistration() â”€â”€â”€â–¶ Create account


login.html
â”œâ”€â”€ Login Form
â”‚   â”œâ”€â”€ Email Input
â”‚   â”œâ”€â”€ Password Input
â”‚   â””â”€â”€ Login Button â”€â”€â”€â–¶ handleLogin()
â”‚
â””â”€â”€ Event Handlers
    â””â”€â”€ handleLogin() â”€â”€â”€â–¶ auth.signInWithPassword()
```

---

## ğŸ“Š State Management

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          STATE FLOW                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Registration Page State Machine:

                    [Page Load]
                         â”‚
                         â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚   LOADING        â”‚
               â”‚                  â”‚
               â”‚ â€¢ Extract token  â”‚
               â”‚ â€¢ Init client    â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚   VALIDATING     â”‚
               â”‚                  â”‚
               â”‚ â€¢ Check token    â”‚â”€â”€â”€â”€â”€â”€â” Invalid/Expired
               â”‚ â€¢ Query DB       â”‚      â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
                        â”‚                â”‚
                   Validâ”‚                â”‚
                        â–¼                â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚   READY          â”‚  â”‚    ERROR         â”‚
               â”‚                  â”‚  â”‚                  â”‚
               â”‚ â€¢ Show form      â”‚  â”‚ â€¢ Show error     â”‚
               â”‚ â€¢ Enable inputs  â”‚  â”‚ â€¢ Disable form   â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                   Submitâ”‚
                        â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚   CREATING       â”‚
               â”‚                  â”‚
               â”‚ â€¢ Validate pwd   â”‚â”€â”€â”€â”€â”€â”€â” Validation fail
               â”‚ â€¢ Create account â”‚      â”‚
               â”‚ â€¢ Update DB      â”‚      â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
                        â”‚                â”‚
                   Success               â”‚
                        â–¼                â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚   SUCCESS        â”‚  â”‚    ERROR         â”‚
               â”‚                  â”‚  â”‚                  â”‚
               â”‚ â€¢ Show success   â”‚  â”‚ â€¢ Show error     â”‚
               â”‚ â€¢ Redirect in 2s â”‚  â”‚ â€¢ Reset form     â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”Œ API Endpoints

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         API STRUCTURE                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Supabase Edge Functions:
POST /functions/v1/send-invitation
â”œâ”€â”€ Headers
â”‚   â”œâ”€â”€ Authorization: Bearer <ANON_KEY>
â”‚   â””â”€â”€ Content-Type: application/json
â”œâ”€â”€ Body
â”‚   â””â”€â”€ { "email": "user@example.com" }
â””â”€â”€ Response
    â”œâ”€â”€ 200 OK
    â”‚   â””â”€â”€ { "success": true, "email": "...", "registration_url": "..." }
    â”œâ”€â”€ 400 Bad Request
    â”‚   â””â”€â”€ { "error": "Email is required" }
    â””â”€â”€ 500 Internal Server Error
        â””â”€â”€ { "error": "Failed to send invitation", "details": "..." }


Supabase Database RPCs:
POST /rest/v1/rpc/create_user_invitation
â”œâ”€â”€ Headers
â”‚   â”œâ”€â”€ apikey: <ANON_KEY>
â”‚   â””â”€â”€ Content-Type: application/json
â”œâ”€â”€ Body
â”‚   â””â”€â”€ { "p_email": "user@example.com" }
â””â”€â”€ Response
    â””â”€â”€ { "invitation_id": "...", "token": "...", "email": "..." }


Supabase Auth:
POST /auth/v1/signup
â”œâ”€â”€ Headers
â”‚   â”œâ”€â”€ apikey: <ANON_KEY>
â”‚   â””â”€â”€ Content-Type: application/json
â”œâ”€â”€ Body
â”‚   â”œâ”€â”€ email: "user@example.com"
â”‚   â”œâ”€â”€ password: "******"
â”‚   â””â”€â”€ options: { data: {...} }
â””â”€â”€ Response
    â””â”€â”€ { "user": {...}, "session": {...} }
```

---

This architecture provides:
- âœ… **Security**: Multi-layer protection
- âœ… **Scalability**: Server-side processing
- âœ… **Reliability**: Built-in error handling
- âœ… **Maintainability**: Clear separation of concerns
- âœ… **Performance**: Optimized data flow
