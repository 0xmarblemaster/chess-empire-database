<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Student Profile - Chess Empire</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Outfit:wght@600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="student-styles.css">
    <link rel="stylesheet" href="modal-styles.css">
    <script src="i18n.js?v=1"></script>
</head>
<body>
    <div class="profile-container">
        <div class="nav-buttons">
            <a href="index.html" class="back-button">
                <i data-lucide="arrow-left" style="width: 18px; height: 18px;"></i>
                <span data-i18n="student.back"></span>
            </a>
            <a href="admin.html" class="dashboard-button" id="dashboardButton" style="display: none;">
                <i data-lucide="layout-dashboard" style="width: 18px; height: 18px;"></i>
                <span data-i18n="common.dashboard">Dashboard</span>
            </a>
        </div>

        <div class="profile-card" id="studentProfile">
            <!-- Content will be loaded by JavaScript -->
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
        <div class="modal-overlay" onclick="closeEditModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" data-i18n="student.editProfile">Edit Student Profile</h2>
                <button class="modal-close" onclick="closeEditModal()">
                    <i data-lucide="x" style="width: 24px; height: 24px;"></i>
                </button>
            </div>

            <form id="editStudentForm" class="modal-body">
                <!-- Student Information -->
                <div class="form-section">
                    <h3 class="form-section-title" data-i18n="admin.modals.add.studentInfo">Student Information</h3>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="editFirstName" class="form-label" data-i18n="admin.modals.add.firstName">First Name</label>
                            <input type="text" id="editFirstName" name="firstName" class="form-input" required data-i18n-placeholder="admin.modals.add.firstNamePlaceholder">
                        </div>
                        <div class="form-group">
                            <label for="editLastName" class="form-label" data-i18n="admin.modals.add.lastName">Last Name</label>
                            <input type="text" id="editLastName" name="lastName" class="form-input" required data-i18n-placeholder="admin.modals.add.lastNamePlaceholder">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="editAge" class="form-label" data-i18n="student.age">Age</label>
                            <input type="number" id="editAge" name="age" class="form-input" required min="5" max="18" data-i18n-placeholder="admin.modals.edit.agePlaceholder">
                        </div>
                        <div class="form-group">
                            <label for="editGender" class="form-label" data-i18n="admin.modals.add.gender">Gender</label>
                            <select id="editGender" name="gender" class="form-input">
                                <option value="" data-i18n="admin.modals.edit.genderUnknown">Unknown</option>
                                <option value="male" data-i18n="admin.modals.add.genderMale">Male</option>
                                <option value="female" data-i18n="admin.modals.add.genderFemale">Female</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Photo Upload -->
                <div class="form-section">
                    <h3 class="form-section-title" data-i18n="admin.modals.add.photo">Photo</h3>
                    <div class="photo-upload-container">
                        <div class="photo-preview" id="editPhotoPreview">
                            <i data-lucide="user" style="width: 64px; height: 64px; color: #94a3b8;"></i>
                        </div>
                        <div class="photo-upload-actions">
                            <label for="editPhotoUpload" class="btn-upload">
                                <i data-lucide="upload" style="width: 18px; height: 18px;"></i>
                                <span data-i18n="admin.modals.add.uploadPhoto">Upload Photo</span>
                            </label>
                            <input type="file" id="editPhotoUpload" name="photo" accept="image/*" style="display: none;" onchange="previewEditPhoto(event)">
                            <button type="button" id="editRemovePhotoBtn" class="btn-remove-photo" style="display: none;" onclick="removeEditPhoto()">
                                <i data-lucide="trash-2" style="width: 16px; height: 16px;"></i>
                                <span data-i18n="admin.modals.edit.removePhoto">Remove</span>
                            </button>
                            <p class="upload-hint" data-i18n="admin.modals.add.uploadHint">Max 5MB (JPG, PNG)</p>
                        </div>
                    </div>
                    <input type="hidden" id="editCurrentPhotoUrl" name="currentPhotoUrl">
                </div>

                <!-- Branch and Coach Assignment -->
                <div class="form-section">
                    <h3 class="form-section-title" data-i18n="admin.modals.add.branchCoach">Branch & Coach</h3>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="editBranchSelect" class="form-label" data-i18n="admin.modals.add.branch">Branch</label>
                            <select id="editBranchSelect" name="branch" class="form-input" required onchange="updateEditCoachOptions()">
                                <option value="" data-i18n="admin.modals.add.branchSelect">Select Branch</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editCoachSelect" class="form-label" data-i18n="admin.modals.add.coach">Coach</label>
                            <select id="editCoachSelect" name="coach" class="form-input" required>
                                <option value="" data-i18n="admin.modals.add.coachSelect">Select Coach</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Level & Progress -->
                <div class="form-section">
                    <h3 class="form-section-title" data-i18n="admin.modals.edit.level">Level & Progress</h3>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="editRazryadSelect" class="form-label" data-i18n="admin.modals.add.razryad">Razryad</label>
                            <select id="editRazryadSelect" name="razryad" class="form-input">
                                <option value="" data-i18n="admin.razryad.none">None</option>
                                <option value="4th" data-i18n="admin.razryad.4th">4th</option>
                                <option value="3rd" data-i18n="admin.razryad.3rd">3rd</option>
                                <option value="2nd" data-i18n="admin.razryad.2nd">2nd</option>
                                <option value="1st" data-i18n="admin.razryad.1st">1st</option>
                                <option value="KMS" data-i18n="admin.razryad.kms">KMS</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="editStatusSelect" class="form-label" data-i18n="admin.modals.add.status">Status</label>
                            <select id="editStatusSelect" name="status" class="form-input" required>
                                <option value="active" data-i18n="admin.modals.add.statusActive">Active</option>
                                <option value="frozen" data-i18n="admin.modals.add.statusFrozen">Frozen</option>
                                <option value="inactive" data-i18n="admin.modals.add.statusInactive">Inactive</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="editCurrentLevel" class="form-label" data-i18n="admin.modals.edit.currentLevel">Current Level</label>
                            <input type="number" id="editCurrentLevel" name="currentLevel" class="form-input" min="1" max="10" data-i18n-placeholder="admin.modals.edit.levelPlaceholder">
                        </div>
                        <div class="form-group">
                            <label for="editCurrentLesson" class="form-label" data-i18n="admin.modals.edit.currentLesson">Current Lesson</label>
                            <input type="number" id="editCurrentLesson" name="currentLesson" class="form-input" min="1" max="105" data-i18n-placeholder="admin.modals.edit.lessonPlaceholder">
                        </div>
                    </div>
                </div>

                <!-- Bot Progress -->
                <div class="form-section">
                    <h3 class="form-section-title" data-i18n="admin.modals.edit.botProgress">Bot Progress</h3>
                    <p class="form-hint" data-i18n="admin.modals.edit.botProgressHint">Check bots the student has defeated</p>
                    <div id="editBotGrid" class="edit-bot-grid">
                        <!-- Bot checkboxes will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Puzzle Rush Progress -->
                <div class="form-section">
                    <h3 class="form-section-title" data-i18n="admin.modals.edit.puzzleRush">Puzzle Rush</h3>
                    <p class="form-hint" data-i18n="admin.modals.edit.puzzleRushHint">Select the highest level achieved</p>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="editPuzzleRushScore" class="form-label" data-i18n="admin.modals.edit.puzzleRushScore">Best Score</label>
                            <select id="editPuzzleRushScore" name="puzzleRushScore" class="form-input">
                                <option value="0" data-i18n="admin.modals.edit.puzzleRushNone">Not achieved</option>
                                <option value="6">Level 1 - 6 puzzles (Beginner)</option>
                                <option value="10">Level 2 - 10 puzzles (Beginner)</option>
                                <option value="15">Level 3 - 15 puzzles (Intermediate)</option>
                                <option value="20">Level 4 - 20 puzzles (Intermediate)</option>
                                <option value="25">Level 5 - 25 puzzles (Advanced)</option>
                                <option value="30">Level 6 - 30 puzzles (Advanced)</option>
                                <option value="35">Level 7 - 35 puzzles (Expert)</option>
                                <option value="40">Level 8 - 40 puzzles (Expert)</option>
                                <option value="45">Level 9 - 45 puzzles (Master)</option>
                                <option value="50">Level 10 - 50 puzzles (Master)</option>
                                <option value="55">Level 11 - 55 puzzles (Master)</option>
                                <option value="60">Level 12 - 60 puzzles (Master)</option>
                            </select>
                        </div>
                    </div>
                </div>
            </form>

            <div class="modal-footer">
                <button type="button" class="btn-secondary" onclick="closeEditModal()" data-i18n="admin.modals.add.cancel">Cancel</button>
                <button type="submit" form="editStudentForm" class="btn-primary" onclick="saveStudentEdits(event)">
                    <i data-lucide="save" style="width: 18px; height: 18px;"></i>
                    <span data-i18n="admin.modals.edit.save">Save Changes</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Load Supabase -->
    <script src="toast-notifications.js?v=1762500000"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js?v=1762345505"></script>
    <script src="supabase-client.js?v=1765285600"></script>
    <script src="supabase-data.js?v=1765296000"></script>

    <!-- Load constants for bots, leagues, tiers -->
    <script src="constants.js?v=1765290000"></script>

    <!-- Load data and student profile -->
    <script src="data.js?v=1765283500"></script>
    <script src="crud.js?v=1765283500"></script>
    <script src="student.js?v=1765295000"></script>
    <script>
        function updateStudentTitle(studentName) {
            const baseTitle = t('student.title');
            document.title = studentName ? `${studentName} | ${baseTitle}` : baseTitle;
        }

        document.addEventListener('languagechange', () => {
            if (window.currentStudentName) {
                updateStudentTitle(window.currentStudentName);
            } else {
                updateStudentTitle();
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
        });

        window.updateStudentTitle = updateStudentTitle;
    </script>
</body>
</html>
